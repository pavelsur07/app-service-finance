# ЗАДАЧА (Codex)

Спроектировать и добавить НОВЫЙ модуль `<ModuleName>` в существующий Symfony-проект. Важно: строго следовать правилам архитектуры проекта, не выдумывать новые подходы.

## Модуль
- **Название модуля:** `<ModuleName>`
- **Краткое назначение модуля:** `<1–2 предложения, что делает модуль>`

## Контекст проекта
- Symfony проект расположен в папке: `site/`
- Проект использует модульную структуру (Balance, Telegram, Loan, Marketplace и т.д.)
- Новая функциональность добавляется **только** через модуль
- Общие папки (`src/Service`, `src/Controller`, `src/Entity` и т.д.) считаются legacy/shared

## Общие правила (обязательно соблюдать)
1. **Не добавлять код** в:
   - `src/Service`
   - `src/Controller`
   - `src/Entity`
   - `src/Repository`
   - `templates/_partials`
2. Весь код модуля должен находиться в `src/<ModuleName>/...`
3. Использовать существующие подходы проекта (Doctrine, Form, Twig, Symfony Controller)
4. **Не** рефакторить существующие модули и файлы, только добавлять новый модуль
5. **Не** менять `phpunit.xml`, `composer.json`, docker, CI и конфигурации

## Структура модуля (создать при необходимости)
- `src/<ModuleName>/Controller`
- `src/<ModuleName>/Service`
- `src/<ModuleName>/Entity`
- `src/<ModuleName>/Repository`
- `src/<ModuleName>/Form`
- `src/<ModuleName>/DTO` (если нужно)
- `src/<ModuleName>/Enum` (если нужно)

## Шаблоны (Twig)
- Шаблоны размещать в: `templates/<module_name>/`
- Подключение шаблонов через `render()` без хардкода путей вне модуля
- Для общих элементов использовать `templates/partials`

## Контроллеры
- Контроллеры должны быть только в `src/<ModuleName>/Controller`
- Один контроллер = одна зона ответственности
- Минимум логики в контроллере (вся логика в сервисах)

## Сервисы
- Сервисы должны описывать use-case (оркестрация)
- Не создавать "God service"
- Доменные проверки выносить в отдельные классы внутри модуля (Validator, Policy, Calculator)

## Entities / Repositories
- Entity и Repository относятся **только** к модулю
- Не использовать Entity из других модулей напрямую (через сервисы)

## Тесты
- Добавлять тесты в:
  - `tests/Unit/<ModuleName>`
  - `tests/Integration/<ModuleName>` (если нужно)
- Новые тесты **не** помечать `@group legacy`
- Новые тесты должны проходить в `composer test:smoke` или не ломать его

## Роутинг
- Использовать атрибуты маршрутов Symfony
- Префикс маршрутов должен быть: `/<module_name>`

## Что сделать
1. Создать структуру модуля `<ModuleName>`
2. Добавить минимальный рабочий Controller + Service
3. Добавить базовый Twig-шаблон (если есть UI)
4. Убедиться, что модуль подключается и не ломает существующий функционал

## Проверка
- `composer test:smoke` проходит
- Нет новых файлов в legacy-директориях
- Код модуля изолирован и читаем

## Запрещено
- Массовые правки вне модуля
- Перенос файлов из других модулей
- Изменение существующих API без отдельной задачи
