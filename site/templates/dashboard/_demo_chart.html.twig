<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title mb-0">–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–π –∏ —Å–ø–∏—Å–∞–Ω–∏–π</h3>

        <div class="d-flex align-items-center gap-2">
            {# –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–µ—Ä–∏–æ–¥–∞ #}
            <select id="periodSelect" class="form-select form-select-sm w-auto">
                <option value="month" selected>–ü–æ –º–µ—Å—è—Ü–∞–º</option>
                <option value="week">–ü–æ –Ω–µ–¥–µ–ª—è–º</option>
                <option value="day">–ü–æ –¥–Ω—è–º</option>
            </select>

            {# –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∞: –ª–∏–Ω–∏—è / —Å—Ç–æ–ª–±—Ü—ã #}
            <div class="btn-group btn-group-sm" role="group" aria-label="Chart view">
                <button type="button"
                        class="btn btn-outline-primary active"
                        id="btnViewLine"
                        data-view="line"
                        title="–õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫">
                    <i class="ti ti-chart-line"></i>
                </button>
                <button type="button"
                        class="btn btn-outline-primary"
                        id="btnViewBar"
                        data-view="bar"
                        title="–°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞">
                    <i class="ti ti-chart-bar"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="card-body" style="height: 360px;">
        <canvas id="cashflowChart"></canvas>
    </div>
</div>


{# Chart.js –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ, –∑–¥–µ—Å—å –¥–ª—è –¥–µ–º–æ —á–µ—Ä–µ–∑ CDN #}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('cashflowChart').getContext('2d');
    const periodSelect = document.getElementById('periodSelect');
    const btnViewLine = document.getElementById('btnViewLine');
    const btnViewBar = document.getElementById('btnViewBar');

    // üíæ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ (–±–µ–∑ API)
    const demoData = {
        month: {
            labels: ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç'],
            income:  [358000, 520000, 460000, 322000, 789000, 1240000, 730000, 881000],
            expenses:[248000, 417000, 322000, 297000, 512000, 1110000, 731000, 455000]
        },
        week: {
            labels: ['1 –Ω–µ–¥.', '2 –Ω–µ–¥.', '3 –Ω–µ–¥.', '4 –Ω–µ–¥.', '5 –Ω–µ–¥.'],
            income:  [120000, 160000, 90000, 210000, 180000],
            expenses:[ 90000, 130000, 80000, 170000, 150000]
        },
        day: {
            labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
            income:  [20000, 35000, 18000, 42000, 50000, 30000, 15000],
            expenses:[15000, 20000, 17000, 30000, 38000, 25000, 12000]
        }
    };

    let currentView = 'line';   // line | bar
    let currentPeriod = 'month';// month | week | day
    let chart = null;

    function buildConfig(periodKey, viewType) {
        const src = demoData[periodKey];

        return {
            type: viewType,
            data: {
                labels: src.labels,
                datasets: [
                    {
                        label: '–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è',
                        data: src.income,
                        backgroundColor: 'rgba(34, 197, 94, 0.25)',  // –∑–µ–ª—ë–Ω—ã–π –ø–æ–¥ Tabler
                        borderColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    },
                    {
                        label: '–°–ø–∏—Å–∞–Ω–∏—è',
                        data: src.expenses,
                        backgroundColor: 'rgba(37, 99, 235, 0.25)',   // —Å–∏–Ω–∏–π –ø–æ–¥ Tabler
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { display: true },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const v = context.parsed.y || 0;
                                return context.dataset.label + ': ' +
                                    v.toLocaleString('ru-RU') + ' ‚ÇΩ';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function (value) {
                                return value.toLocaleString('ru-RU') + ' ‚ÇΩ';
                            }
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        };
    }

    function renderChart() {
        if (chart) {
            chart.destroy();
        }
        const config = buildConfig(currentPeriod, currentView);
        chart = new Chart(ctx, config);
    }

    // üîÅ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞
    periodSelect.addEventListener('change', function () {
        currentPeriod = this.value;
        renderChart();
    });

    // üîÅ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
    function setView(view) {
        currentView = view;
        btnViewLine.classList.toggle('active', view === 'line');
        btnViewBar.classList.toggle('active', view === 'bar');
        renderChart();
    }

    btnViewLine.addEventListener('click', function () { setView('line'); });
    btnViewBar.addEventListener('click', function () { setView('bar'); });

    // –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
    renderChart();
});
</script>

