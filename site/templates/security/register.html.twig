{# templates/security/register.html.twig #}
<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fin-Plan — Регистрация аккаунта</title>
    <meta name="description" content="Создайте аккаунт Fin-Plan: финансовый учёт для e-commerce и SMB. 7 дней бесплатно, без карты и обязательств.">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root{
            --brand-primary:#0A1548; --brand-secondary:#101940; --accent:#FF1F1F;
            --text:#1C1C1C; --muted:#6c757d; --bg:#ffffff; --bg-soft:#f7f8fb;
        }
        html,body{
            height:100%;
            background:
                radial-gradient(1200px 500px at 80% -50%, rgba(255,31,31,.08), transparent 60%),
                radial-gradient(1000px 600px at -20% -40%, rgba(10,21,72,.18), transparent 60%),
                var(--bg-soft);
            color:var(--text);
        }
        .auth-wrapper{min-height:100vh;display:flex;align-items:center;}
        .auth-card{background:#fff;border:1px solid #e7eaf3;box-shadow:0 10px 30px rgba(16,25,64,.08);border-radius:1rem}
        .btn-accent{--bs-btn-bg:var(--accent);--bs-btn-border-color:var(--accent);--bs-btn-hover-bg:#e11a1a;--bs-btn-hover-border-color:#e11a1a;--bs-btn-color:#fff}
        .section-title{font-weight:800;letter-spacing:-.01em}
        .password-meter{height:6px;background:#e9ecef;border-radius:8px;overflow:hidden}
        .password-meter>div{height:100%;width:0;transition:width .25s}
    </style>
</head>
<body>
<main class="auth-wrapper">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8 col-xxl-6">

                <div class="auth-card p-4 p-md-5">
                    <div class="mb-4 text-center">
                        <h1 class="section-title mb-2">Создание аккаунта</h1>
                        <p class="text-muted mb-0">7 дней бесплатно • без карты и обязательств</p>
                    </div>

                    {#<div class="d-grid gap-2 mb-3">
                        <button type="button" class="btn btn-outline-secondary">
                            <i class="bi bi-google me-2"></i> Продолжить с Google
                        </button>
                        <button type="button" class="btn btn-outline-secondary">
                            <i class="bi bi-apple me-2"></i> Продолжить с Apple
                        </button>
                    </div>#}

                    {#<div class="text-center my-3 position-relative">
                        <span class="bg-white px-3 text-muted">или</span>
                        <hr class="position-absolute top-50 start-0 w-100 translate-middle-y m-0"/>
                    </div>#}

                    {# ——— ФОРМА SYMFONY ——— #}
                    {{ form_start(registrationForm, {
                        attr: { id: 'signupForm', class: 'needs-validation', novalidate: 'novalidate' }
                    }) }}
                    <div class="row g-3">
                        <div class="col-12">
                            {{ form_label(registrationForm.email, 'Email', { label_attr: { class: 'form-label small' } }) }}
                            {{ form_widget(registrationForm.email, {
                                attr: { class: 'form-control', placeholder: 'ivan@company.ru' }
                            }) }}
                            <div class="invalid-feedback">Введите корректный email</div>
                            {{ form_errors(registrationForm.email) }}
                        </div>

                        <div class="col-12">
                            {{ form_label(registrationForm.plainPassword, 'Пароль', { label_attr: { class: 'form-label small' } }) }}
                            <div class="input-group">
                                {# ДАЁМ единый id="password", чтобы JS-скрипт работал стабильно #}
                                {{ form_widget(registrationForm.plainPassword, {
                                    attr: { class: 'form-control', id: 'password', placeholder: '••••••••', minlength: 8, autocomplete: 'new-password' }
                                }) }}
                                <button class="btn btn-outline-secondary" type="button" id="togglePass">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <div class="invalid-feedback">Минимум 8 символов</div>
                            </div>
                            <div class="password-meter mt-2" aria-hidden="true"><div id="meterFill"></div></div>
                            <div class="form-text">Используйте буквы разного регистра, цифры и символы</div>
                            {{ form_errors(registrationForm.plainPassword) }}
                        </div>

                        <div class="col-12">
                            <div class="form-check">
                                {{ form_widget(registrationForm.agreeTerms, {
                                    attr: { class: 'form-check-input', id: registrationForm.agreeTerms.vars.id }
                                }) }}
                                {#<label class="form-check-label" for="{{ registrationForm.agreeTerms.vars.id }}">
                                    Я принимаю Пользовательское соглашение и Политику конфиденциальности
                                </label>#}
                                <div class="invalid-feedback">Нужно подтвердить согласие</div>
                            </div>
                            {{ form_errors(registrationForm.agreeTerms) }}
                        </div>

                        <div class="col-12 d-grid mt-2">
                            <button type="submit" class="btn btn-accent btn-lg">Создать аккаунт</button>
                        </div>

                        <div class="col-12 text-center">
                            <div class="form-text">Регистрируясь, вы соглашаетесь на обработку персональных данных</div>
                        </div>
                    </div>
                    {{ form_end(registrationForm) }}

                    <div class="text-center mt-4">
                        <span class="text-muted">Уже есть аккаунт?</span>
                        <a href="{{ path('app_login') }}" class="ms-1">Войти</a>
                    </div>
                </div>

                <p class="small text-center text-muted mt-3">© {{ "now"|date("Y") }} Fin-Plan. Все права защищены.</p>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script>
    (function() {
        const initPasswordMeter = function () {
            const toggle = document.getElementById('togglePass');
            const pwd    = document.getElementById('password');
            const meter  = document.getElementById('meterFill');
            const form   = document.getElementById('signupForm');

            if (toggle && !toggle.dataset.boundToggle && pwd) {
                toggle.addEventListener('click', function(){
                    const isPwd = pwd.type === 'password';
                    pwd.type = isPwd ? 'text' : 'password';
                    this.innerHTML = isPwd ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
                });
                toggle.dataset.boundToggle = 'true';
            }

            function score(p){
                let s = 0;
                if(p.length >= 8) s += 25;
                if(/[A-Z]/.test(p)) s += 25;
                if(/[0-9]/.test(p)) s += 25;
                if(/[^A-Za-z0-9]/.test(p)) s += 25;
                return s;
            }

            if (pwd && meter && !pwd.dataset.boundMeter) {
                const updateMeter = function(value){
                    const sc = score(value);
                    meter.style.width = sc + '%';
                    meter.style.background = sc < 50 ? '#ef4444' : (sc < 75 ? '#f59e0b' : '#16a34a');
                };

                pwd.addEventListener('input', function(){
                    updateMeter(this.value);
                });
                updateMeter(pwd.value || '');
                pwd.dataset.boundMeter = 'true';
            }

            if (form && !form.dataset.boundValidation) {
                form.addEventListener('submit', function (e) {
                    if (!form.checkValidity()) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
                form.dataset.boundValidation = 'true';
            }
        };

        document.addEventListener('DOMContentLoaded', initPasswordMeter);
        document.addEventListener('turbo:load', initPasswordMeter);

        if (document.readyState !== 'loading') {
            initPasswordMeter();
        }
    })();
</script>
</body>
</html>
