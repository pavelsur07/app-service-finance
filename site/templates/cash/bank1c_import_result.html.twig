{% extends 'base.html.twig' %}

{% block title %}Результат импорта 1С{% endblock %}

{% block body %}
    <div class="page-header d-print-none">
        <div class="container-xl">
            <div class="row g-2 align-items-center">
                <div class="col">
                    <h2 class="page-title">Импорт банковской выписки 1С завершён</h2>
                    <div class="text-muted small">
                        {% if filename %}
                            Файл: <strong>{{ filename }}</strong>
                        {% endif %}
                        {% if selectedAccount %}
                            · Счёт: <strong>{{ selectedAccount.name }}</strong>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-xl mt-3">
        {% if importLog is defined and importLog %}
            <div class="card my-3">
                <div class="card-header"><h3 class="card-title">Итоги импорта</h3></div>
                <div class="card-body">
                    <div class="row row-cards">
                        {% set stats = [
                            {'label':'Создано транзакций','val':importLog.createdCount},
                            {'label':'Пропущено дублей','val':importLog.skippedDuplicates},
                            {'label':'Ошибок','val':importLog.errorsCount},
                            {'label':'Предпросмотр','val': importLog.preview ? 'Да' : 'Нет'}
                        ] %}
                        {% for s in stats %}
                            <div class="col-sm-6 col-md-3">
                                <div class="card"><div class="card-body">
                                    <div class="h1">{{ s.val }}</div>
                                    <div class="text-secondary">{{ s.label }}</div>
                                </div></div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="mt-2 text-secondary">
                        Источник: <b>{{ importLog.source }}</b> · Файл: <b>{{ importLog.fileName ?? '—' }}</b><br>
                        Начало: {{ importLog.startedAt|date('Y-m-d H:i:s') }} · Конец: {{ importLog.finishedAt|date('Y-m-d H:i:s') }}
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="row g-3">
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Итоги обработки</h3>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Создано операций</span>
                            <span class="fw-bold text-success">{{ summary.created ?? 0 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Найдено дублей</span>
                            <span class="fw-bold text-warning">{{ summary.duplicates ?? 0 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Ошибок</span>
                            <span class="fw-bold text-danger">{{ summary.errors ?? 0 }}</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Диапазон дат</h3>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Минимальная дата</span>
                            <span class="fw-bold">{{ summary.minDate ? summary.minDate|date('d.m.Y') : '—' }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Максимальная дата</span>
                            <span class="fw-bold">{{ summary.maxDate ? summary.maxDate|date('d.m.Y') : '—' }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-body d-flex justify-content-between flex-column flex-md-row gap-2">
                <a href="{{ path('cash_bank1c_import_upload') }}" class="btn btn-outline-secondary">Импортировать ещё файл</a>
                <a href="{{ path('cash_transaction_index') }}" class="btn btn-primary">Перейти к операциям</a>
            </div>
        </div>
    </div>
{% endblock %}
