{# –í–∫–ª–∞–¥–∫–∞: –ü–æ SKU #}

{# –§–∏–ª—å—Ç—Ä—ã #}
<div class="mb-3">
    <form class="row g-2">
        <input type="hidden" name="tab" value="sku">
        <input type="hidden" name="period" value="{{ period }}">
        <input type="hidden" name="marketplace" value="{{ marketplace }}">

        <div class="col-md-3">
            <input type="text" class="form-control" placeholder="–ü–æ–∏—Å–∫ SKU..." name="search">
        </div>
        <div class="col-md-2">
            <select class="form-select" name="category">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <option>–û–¥–µ–∂–¥–∞</option>
                <option>–û–±—É–≤—å</option>
                <option>–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select" name="sort">
                <option value="revenue">–ü–æ –≤—ã—Ä—É—á–∫–µ</option>
                <option value="margin">–ü–æ –º–∞—Ä–∂–µ</option>
                <option value="roi">–ü–æ ROI</option>
                <option value="turnover">–ü–æ –æ–±–æ—Ä–æ—Ç—É</option>
            </select>
        </div>
        <div class="col-md-1">
            <button type="submit" class="btn btn-primary w-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /></svg>
            </button>
        </div>
    </form>
</div>

{# –¢–∞–±–ª–∏—Ü–∞ #}
<div class="table-responsive">
    <table class="table table-vcenter card-table table-striped">
        <thead>
        <tr>
            <th>SKU</th>
            <th class="text-end">–ü—Ä–æ–¥–∞–Ω–æ</th>
            <th class="text-end">–í—ã—Ä—É—á–∫–∞</th>
            <th class="text-end">–°–µ–±–µ—Å.</th>
            <th class="text-end">–ö–æ–º–∏—Å—Å–∏—è</th>
            <th class="text-end">–õ–æ–≥–∏—Å—Ç–∏–∫–∞</th>
            <th class="text-end">–†–µ–∫–ª–∞–º–∞</th>
            <th class="text-end">CM ‚ÇΩ</th>
            <th class="text-end">CM %</th>
            <th class="text-end">–û–±–æ—Ä–∞—á.</th>
            <th class="text-end">ROI</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        {% for item in sku_data %}
            <tr class="
                {% if item.status == 'danger' %}table-danger
                {% elseif item.status == 'warning' %}table-warning
                {% else %}table-success{% endif %}
            ">
                <td>
                    <div class="d-flex align-items-center">
                        {% if item.status == 'danger' %}
                            <span class="badge bg-red me-2">üî¥</span>
                        {% elseif item.status == 'warning' %}
                            <span class="badge bg-yellow me-2">üü°</span>
                        {% else %}
                            <span class="badge bg-green me-2">üü¢</span>
                        {% endif %}
                        <strong>{{ item.sku }}</strong>
                    </div>
                </td>
                <td class="text-end">{{ item.sold }}</td>
                <td class="text-end">{{ item.revenue|number_format(0, '.', ' ') }}</td>
                <td class="text-end">{{ item.cogs|number_format(0, '.', ' ') }}</td>
                <td class="text-end text-danger">{{ item.commission|number_format(0, '.', ' ') }}</td>
                <td class="text-end text-danger">{{ item.logistics|number_format(0, '.', ' ') }}</td>
                <td class="text-end text-danger">{{ item.advertising|number_format(0, '.', ' ') }}</td>
                <td class="text-end"><strong>{{ item.cm_rub|number_format(0, '.', ' ') }}</strong></td>
                <td class="text-end"><strong>{{ item.cm_percent }}%</strong></td>
                <td class="text-end">{{ item.turnover }} –¥–Ω</td>
                <td class="text-end">{{ item.roi }}%</td>
                <td class="text-end">
                    <button class="btn btn-sm btn-ghost-primary" data-bs-toggle="offcanvas" data-bs-target="#sku-details-{{ loop.index }}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
                    </button>
                </td>
            </tr>

            {# Drill-down –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å #}
            <div class="offcanvas offcanvas-end" tabindex="-1" id="sku-details-{{ loop.index }}">
                <div class="offcanvas-header">
                    <h3 class="offcanvas-title">{{ item.sku }}</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                </div>
                <div class="offcanvas-body">
                    <h4 class="mb-3">Unit-—ç–∫–æ–Ω–æ–º–∏–∫–∞</h4>
                    <div class="list-group list-group-flush mb-4">
                        <div class="list-group-item d-flex justify-content-between">
                            <span>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏</span>
                            <strong>{{ (item.revenue / item.sold)|number_format(0) }} ‚ÇΩ</strong>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <span>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</span>
                            <span>{{ (item.cogs / item.sold)|number_format(0) }} ‚ÇΩ</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <span>–ö–æ–º–∏—Å—Å–∏—è/—à—Ç</span>
                            <span>{{ (item.commission / item.sold)|number_format(0) }} ‚ÇΩ</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <span>–õ–æ–≥–∏—Å—Ç–∏–∫–∞/—à—Ç</span>
                            <span>{{ (item.logistics / item.sold)|number_format(0) }} ‚ÇΩ</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <span>–†–µ–∫–ª–∞–º–∞/—à—Ç</span>
                            <span>{{ (item.advertising / item.sold)|number_format(0) }} ‚ÇΩ</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <span><strong>–ú–∞—Ä–∂–∞/—à—Ç</strong></span>
                            <strong class="text-success">{{ (item.cm_rub / item.sold)|number_format(0) }} ‚ÇΩ</strong>
                        </div>
                    </div>

                    <h4 class="mb-3">–î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ (–¥–µ–º–æ)</h4>
                    <div class="placeholder-glow mb-4">
                        <div class="placeholder col-12" style="height: 200px;"></div>
                    </div>

                    <h4 class="mb-3">–ú–µ—Ç—Ä–∏–∫–∏</h4>
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="text-muted small">–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å</div>
                                    <div class="h3 mb-0">{{ item.turnover }} –¥–Ω</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="text-muted small">ROI</div>
                                    <div class="h3 mb-0">{{ item.roi }}%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
        </tbody>
    </table>
</div>

{# –õ–µ–≥–µ–Ω–¥–∞ #}
<div class="mt-3">
    <small class="text-muted">
        <span class="badge bg-green me-2">üü¢</span> CM > 25% |
        <span class="badge bg-yellow me-2">üü°</span> CM 15-25% |
        <span class="badge bg-red me-2">üî¥</span> CM < 15%
    </small>
</div>
