{% extends 'marketplace/layout.html.twig' %}

{% set active_tab = 'sales' %}

{% block tab_content %}
    <div class="table-responsive">
        <table class="table card-table table-vcenter">
            <thead>
            <tr>
                <th>Дата продажи</th>
                <th>Артикул (SKU)</th>
                <th>Товар</th>
                <th class="text-end">Кол-во</th>
                <th class="text-end">Цена</th>
                <th class="text-end">Выручка</th>
                <th class="text-end">Себес.</th>
                <th>ID заказа</th>
            </tr>
            </thead>
            <tbody>
            {% if pager.nbResults == 0 %}
                <tr>
                    <td colspan="7" class="text-center text-muted py-4">Нет данных о продажах</td>
                </tr>
            {% else %}
                {% for sale in pager.currentPageResults %}
                    <tr>
                        <td>{{ sale.saleDate|date('d.m.Y') }}</td>
                        <td><span class="badge bg-azure-lt">{{ sale.listing.marketplaceSku }}</span></td>
                        <td>{{ sale.listing.name }}</td>
                        <td class="text-end">{{ sale.quantity }}</td>
                        <td class="text-end">{{ sale.pricePerUnit|number_format(2, '.', ' ') }} ₽</td>
                        <td class="text-end"><strong>{{ sale.totalRevenue|number_format(2, '.', ' ') }} ₽</strong></td>
                        <td class="text-end">00.0 ₽</td>
                        <td><small class="text-muted">{{ sale.externalOrderId|slice(0, 20) }}...</small></td>
                    </tr>
                {% endfor %}
            {% endif %}
            </tbody>
            {% if pager.nbResults > 0 %}
                <tfoot>
                <tr>
                    <th colspan="3">На странице:</th>
                    <th class="text-end">{{ pager.currentPageResults|reduce((carry, s) => carry + s.quantity, 0) }}</th>
                    <th></th>
                    <th class="text-end">
                        <strong>{{ pager.currentPageResults|reduce((carry, s) => carry + s.totalRevenue, 0)|number_format(2, '.', ' ') }} ₽</strong>
                    </th>
                    <th></th>
                </tr>
                </tfoot>
            {% endif %}
        </table>
    </div>
    {% if pager.haveToPaginate %}
        <div class="card-footer d-flex align-items-center">
            {% include 'partials/_pagerfanta.html.twig' with {'pager': pager, 'route_name': 'marketplace_sales_index'} %}
        </div>
    {% endif %}
{% endblock %}
