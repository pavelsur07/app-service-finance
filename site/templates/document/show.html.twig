{% extends 'base.html.twig' %}
{% block title %}Просмотр документа{% endblock %}
{% block body %}
    <div class="page-header d-print-none">
        <div class="container-xl">
            <h2 class="page-title">Документ {{ item.number ? '№' ~ item.number : item.id }}</h2>
        </div>
    </div>
    <div class="container-xl mt-3">
        <div class="card">
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Дата</dt>
                    <dd class="col-sm-9">{{ item.date|date('Y-m-d H:i') }}</dd>
                    <dt class="col-sm-3">Номер</dt>
                    <dd class="col-sm-9">{{ item.number }}</dd>
                    <dt class="col-sm-3">Тип</dt>
                    <dd class="col-sm-9">{{ item.type.label() }}</dd>
                    {% if documentNature is defined %}
                        <dt class="col-sm-3">Природа</dt>
                        <dd class="col-sm-9">
                            <span class="badge {{ documentNature.badgeClass }}">{{ documentNature.label }}</span>
                        </dd>
                    {% endif %}
                    <dt class="col-sm-3">Контрагент</dt>
                    <dd class="col-sm-9">{{ item.counterparty ? item.counterparty.name : '' }}</dd>
                    <dt class="col-sm-3">Описание</dt>
                    <dd class="col-sm-9">{{ item.description }}</dd>
                </dl>
                <h4>Операции</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Категория</th>
                            <th>Природа</th>
                            <th>Сумма</th>
                            <th>Контрагент</th>
                            <th>Комментарий</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for view in operationViews %}
                            {% set op = view.operation %}
                            <tr>
                                <td>
                                    {% if view.categoryName %}
                                        {{ view.categoryName }}
                                    {% else %}
                                        <span class="text-warning">Без категории</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if view.natureLabel %}
                                        <span class="badge {{ view.badgeClass }}">{{ view.natureLabel }}</span>
                                        {% if view.isFallback %}
                                            <span class="text-warning small ms-1">нужно указать статью</span>
                                        {% endif %}
                                    {% elseif view.needsCategorization %}
                                        <span class="badge bg-warning-lt text-warning">Нужно указать статью</span>
                                    {% else %}
                                        <span class="badge bg-secondary">—</span>
                                    {% endif %}
                                </td>
                                <td>{{ op.amount }}</td>
                                <td>{{ op.counterparty ? op.counterparty.name : '' }}</td>
                                <td>{{ op.comment }}</td>
                            </tr>
                        {% else %}
                            <tr><td colspan="5" class="text-center">Нет операций</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
