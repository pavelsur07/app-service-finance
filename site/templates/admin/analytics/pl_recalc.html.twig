{% extends 'admin/base.html.twig' %}

{% block title %}Admin · PL Recalc{% endblock %}

{% block body %}
  <div class="row row-cards">
    <div class="col-12 col-lg-8">
      {% for label, messages in app.flashes %}
        {% for message in messages %}
          <div class="alert alert-{{ label == 'success' ? 'success' : 'warning' }}" role="alert">
            {{ message }}
          </div>
        {% endfor %}
      {% endfor %}

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Ручной пересчёт PL регистра</h3>
        </div>
        <div class="card-body">
          {{ form_start(form, { action: path('admin_analytics_pl_recalc_handle'), method: 'POST' }) }}
            <div class="mb-3">
              {{ form_row(form.preset) }}
            </div>

            <div class="row">
              <div class="col-md-6">
                {{ form_row(form.from) }}
              </div>
              <div class="col-md-6">
                {{ form_row(form.to) }}
              </div>
            </div>

            <div class="mb-3">
              {{ form_row(form.recalcPl) }}
              {{ form_row(form.warmupSnapshot) }}
            </div>

            <button type="submit" class="btn btn-primary">Пересчитать</button>
          {{ form_end(form) }}
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Статус</h3>
        </div>
        <div class="card-body">
          <div class="text-secondary">Последний пересчёт PL:</div>
          <div class="mt-1 fw-bold">
            {% if lastRecalcAt %}
              {{ lastRecalcAt|date('Y-m-d H:i:s') }}
            {% else %}
              —
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
