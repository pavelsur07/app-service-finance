````md
# Frontend Standards  
## Symfony + Twig + React (MVP → Scalable)

Версия: v1.0  
Статус: Базовый стандарт проекта  
Цель: Быстрое MVP без усложнений + удобная поддержка и масштабирование  

---

# 1. Архитектурная модель

## 1.1 Роли технологий

**Twig = страницы**
- Layout
- Навигация
- SEO / мета
- Роутинг
- Базовая разметка
- Проверка доступа (грубо)

**React = интерактивные острова**
- Таблицы с фильтрами
- Чат
- Дашборды
- Редакторы
- Сложные формы

❗ Мы НЕ делаем SPA в MVP.  
❗ Страница рендерится Twig'ом, React монтируется точечно.

---

# 2. Принцип “React Islands”

На странице может быть 0..N React-компонентов.

Каждый монтируется через:

```html
<div 
  data-react-component="ChatCenter"
  data-props='{"clientId":"uuid"}'>
</div>
````

Запрещено:

* ручной `createRoot()` в разных местах
* inline-инициализация React в Twig

---

# 3. Единый Bootstrap React

Создаётся файл:

```
assets/react/app/bootstrap.ts
```

Он:

* ищет элементы с `data-react-component`
* читает `data-props`
* монтирует соответствующий компонент
* логирует ошибки в dev

❗ Это единственная точка входа React.

---

# 4. Передача данных

## 4.1 Что передаём через Twig

Только:

* companyId
* userId
* csrf
* feature flags
* стартовые фильтры

## 4.2 Что грузим через API

* списки
* таблицы
* агрегаты
* сообщения
* динамические данные

Правило:

> Все изменяемые данные — только через `/api/*`

---

# 5. Структура фронтенда

Структура по фичам:

```
assets/react/
  app/
    bootstrap.ts
  features/
    chat-center/
      api/
      components/
      hooks/
      types.ts
      index.ts
    dashboard/
    cash-transactions/
  shared/
    ui/
    api/
    lib/
    realtime/
  types/
```

❗ Никакой структуры “components/utils” на корне.

---

# 6. HTTP слой

Один HTTP клиент:

```
shared/api/httpClient.ts
```

Он содержит:

* baseURL
* timeout
* интерцептор 401/403
* единый формат ошибок

Запрещено:

* использовать axios/fetch напрямую в компонентах

Все запросы идут через:

```
features/{feature}/api/*
```

---

# 7. Управление состоянием

## MVP правило

По умолчанию:

* useState
* useReducer

Глобальный state вводится только если:

* данные нужны в 3+ независимых местах
* требуется кэширование
* есть realtime-синхронизация

Рекомендуемый компромисс:

* TanStack Query (react-query)

Redux НЕ используется без явной необходимости.

---

# 8. UI стандартизация

Если проект использует:

* Tabler
* Bootstrap
* Tailwind

Создаются обёртки:

```
shared/ui/Button.tsx
shared/ui/Card.tsx
shared/ui/Tabs.tsx
```

❗ Запрещено раскидывать UI-классы хаотично по фичам.

---

# 9. Realtime

Вся работа с Socket.IO находится в:

```
shared/realtime/
```

Компоненты не знают:

* URL сокета
* каналы Redis
* авторизацию транспорта

Компоненты работают через интерфейс:

```ts
subscribe(channel, handler)
unsubscribe(channel)
emit(event, payload)
```

---

# 10. Безопасность

* Секреты не передаются через props
* Проверка доступа — всегда на backend
* CSRF передаётся через header
* Никогда не полагаемся на фронтенд-проверки

---

# 11. Code Splitting (будущее расширение)

Для масштабирования:

```ts
const ChatCenter = lazy(() => import(...))
```

Bootstrap должен поддерживать lazy-загрузку.

---

# 12. Контракты API

* Все API фиксируются в CONTRACT.md
* Типы дублируются в `features/*/types.ts`
* Изменение API = обновление типов

---

# 13. Обработка ошибок

* Dev: console + overlay
* Prod: централизованный логгер (в будущем Sentry)
* API ошибки должны возвращать:

    * message
    * code
    * request_id

---

# 14. Правила PR (Frontend)

Каждый PR обязан:

* [ ] Не ломать bootstrap
* [ ] Не использовать fetch/axios напрямую
* [ ] Использовать shared/ui
* [ ] Использовать типы
* [ ] Не добавлять глобальный state без причины
* [ ] Не менять контракт API без фиксации
* [ ] Соблюдать структуру по фичам

---

# 15. Золотые принципы

1. Twig управляет страницей.
2. React управляет интерактивностью.
3. Один bootstrap.
4. Один http-клиент.
5. Фичи изолированы.
6. Простота важнее идеальной архитектуры.
7. MVP без усложнений.
8. Архитектура готова к масштабированию.

---

Конец документа.

```
```
