# Стратегия тестирования и Builders (MVP) — Accepted

## Тестирование — часть архитектуры
Тестирование фиксируется как часть архитектуры. Тесты обязательны и идут вместе с кодом.

## Контекст (MVP)
MVP: нужна минимальная, строгая и воспроизводимая стратегия тестов без усложнений.

## Решение

### Слои тестирования (3 слоя): Unit / Integration / Functional
- Unit: быстрые проверки логики на уровне одного класса/функции.
- Integration: проверка взаимодействий на границах модулей и инфраструктуры.
- Functional: проверка пользовательских сценариев end-to-end на уровне фич.

### Структура папок тестов
- `tests/Unit`
- `tests/Integration`
- `tests/Functional`

## Правила Builders
- обязательность: сущности создаются через Builders.
- build() / withX(): строим объект через `build()` и конфигурируем через `withX()`.
- persist отдельно: сохранение в БД делается отдельным шагом.

## Правила моков
- запрещено мокать внутренние слои.
- разрешено только внешние границы.
- prefer Fake.

## Последствия (плюсы/минусы)
+ стабильные, повторяемые тесты.
+ прозрачные правила для команды.
- больше времени на подготовку данных.
- строгие ограничения на моки.

## Definition of Done (для PR)
- [ ] тест добавлен вместе с кодом
- [ ] сущности создаются через Builders
- [ ] в Integration/Functional persist/flush/clear сделаны явно в тесте
- [ ] моки только на внешней границе (или Fake)
- [ ] слой теста соответствует задаче (Unit/Integration/Functional)
- [ ] тест изолирован и повторяем
